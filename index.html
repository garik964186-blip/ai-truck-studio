<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>От игрушки до фуры — Чат</title>
    <style>
        /* Индустриальный стиль: темный фон и оранжевые акценты (как спецтехника) */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #1a1a1a; 
            color: #e0e0e0;
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            margin: 0;
        }
        .chat-container { 
            width: 100%; 
            max-width: 600px; 
            background: #2d2d2d; 
            border-radius: 8px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            overflow: hidden;
            border: 1px solid #444;
        }
        .header { 
            background: #d35400; /* Оранжевый, как дорожная техника */
            color: white; 
            padding: 20px; 
            text-align: center; 
            font-weight: bold; 
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px solid #a04000;
        }
        #chat-output { 
            height: 400px; 
            overflow-y: auto; 
            padding: 20px; 
            background: #252525;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* Стили сообщений */
        .msg { padding: 10px 15px; border-radius: 5px; max-width: 85%; line-height: 1.4; }
        .system-msg { color: #aaa; font-style: italic; align-self: center; font-size: 0.9em; }
        .user-msg { 
            background: #3498db; 
            color: white; 
            align-self: flex-end; 
            border-bottom-right-radius: 0;
        }
        .ai-msg { 
            background: #3d3d3d; 
            color: #f1f1f1; 
            align-self: flex-start; 
            border-bottom-left-radius: 0;
            border-left: 4px solid #d35400;
        }
        
        .input-area { display: flex; padding: 15px; gap: 10px; background: #2d2d2d; }
        input { 
            flex: 1; 
            padding: 12px; 
            border: 1px solid #444; 
            border-radius: 4px; 
            outline: none; 
            background: #1a1a1a; 
            color: white;
        }
        input:focus { border-color: #d35400; }
        button { 
            padding: 10px 25px; 
            background: #d35400; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold;
            transition: 0.2s; 
        }
        button:hover { background: #e67e22; }
        button:disabled { background: #555; cursor: not-allowed; }

        /* Полоса прокрутки */
        #chat-output::-webkit-scrollbar { width: 6px; }
        #chat-output::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
    </style>
</head>
<body>

<div class="chat-container">
    <div class="header">ОТ ИГРУШКИ ДО ФУРЫ</div>
    <div id="chat-output">
        <div class="system-msg">Система готова. Жду указаний, босс.</div>
    </div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="Введите команду или вопрос..." autocomplete="off">
        <button id="send-btn">ОТПРАВИТЬ</button>
    </div>
</div>

<script>
    const AI_MODELS = ['openai', 'mistral', 'qwen', 'llama', 'searchgpt'];
    const output = document.getElementById('chat-output');
    const input = document.getElementById('user-input');
    const btn = document.getElementById('send-btn');

    async function sendMessage() {
        const text = input.value.trim();
        if (!text) return;

        input.value = '';
        input.disabled = true;
        btn.disabled = true;
        
        appendMessage('ВЫ', text, 'user-msg');
        const aiDiv = appendMessage('AI', 'Связь со спутником...', 'ai-msg');

        try {
            const response = await fetchWithRetry(text);
            aiDiv.innerText = response;
        } catch (error) {
            aiDiv.innerText = "ОШИБКА: " + error.message;
            aiDiv.style.color = '#ff4d4d';
        } finally {
            input.disabled = false;
            btn.disabled = false;
            input.focus();
            output.scrollTop = output.scrollHeight;
        }
    }

    function appendMessage(sender, text, className) {
        const msg = document.createElement('div');
        msg.className = `msg ${className}`;
        msg.innerHTML = `<strong>${sender}:</strong> <br><span>${text}</span>`;
        output.appendChild(msg);
        output.scrollTop = output.scrollHeight;
        return msg.querySelector('span');
    }

    async function fetchWithRetry(prompt, modelIdx = 0) {
        if (modelIdx >= AI_MODELS.length) {
            throw new Error("Все каналы связи заняты. Попробуйте позже.");
        }

        const model = AI_MODELS[modelIdx];
        const seed = Math.floor(Math.random() * 99999);
        // Используем GET запрос, так как он стабильнее для этого API
        const url = `https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=${model}&seed=${seed}`;
        
        try {
            const response = await fetch(url);

            if (!response.ok) {
                console.warn(`Модель ${model} недоступна. Переключаюсь...`);
                return fetchWithRetry(prompt, modelIdx + 1);
            }

            return await response.text();
        } catch (e) {
            return fetchWithRetry(prompt, modelIdx + 1);
        }
    }

    btn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>

</body>
</html>
