<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ö–Ω–∏–≥–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --accent: #ffcc00; --bg: #1a1a1a; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 20px; }
        .page { display: none; }
        .active { display: block; }
        .input-bar { margin-top: 20px; background: #2a2a2a; padding: 15px; border-radius: 10px; }
        .row { display: flex; gap: 10px; align-items: center; }
        .field { flex: 1; padding: 10px; border-radius: 5px; border: none; background: #333; color: white; }
        .btn { background: #444; border: none; color: white; padding: 10px; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏ */
        .mic-active {
            color: #ff0000 !important;
            animation: pulse-red 1.2s infinite;
        }
        @keyframes pulse-red {
            0% { transform: scale(1); filter: drop-shadow(0 0 2px red); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 10px red); }
            100% { transform: scale(1); filter: drop-shadow(0 0 2px red); }
        }
    </style>
</head>
<body>

    <div id="p2" class="page active">
        <h2>–ê–ª—å–±–æ–º —ç—Å–∫–∏–∑–æ–≤ üé®</h2>
        <div id="art-container"></div>
        <div class="input-bar">
            <div class="row">
                <button onclick="runMic('art')" class="btn" id="m-btn-art">
                    <i class="fas fa-microphone"></i>
                </button>
                <input type="text" id="i-art" class="field" placeholder="–ß—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å?">
                <button onclick="genArt()" class="btn"><i class="fas fa-magic" style="color:var(--accent)"></i></button>
            </div>
        </div>
        <button onclick="showPage('p3')" class="btn">–í —á–∞—Ç üí¨</button>
    </div>

    <div id="p3" class="page">
        <h2>–ß–∞—Ç —Å –∫–Ω–∏–≥–æ–π üí¨</h2>
        <div id="chat-box" style="height: 200px; overflow-y: auto; border: 1px solid #444; padding: 10px;"></div>
        <div class="input-bar">
            <div class="row">
                <button onclick="runMic('chat')" class="btn" id="m-btn">
                    <i class="fas fa-microphone"></i>
                </button>
                <input type="text" id="i-chat" class="field" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å...">
                <button onclick="sendMsg()" class="btn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <button onclick="showPage('p2')" class="btn">–í –∞–ª—å–±–æ–º üé®</button>
    </div>

    <script>
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // –ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª
        function playBeep() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(220, ctx.currentTime);
            g.gain.setValueAtTime(0.1, ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.2);
            osc.connect(g); g.connect(ctx.destination);
            osc.start(); osc.stop(ctx.currentTime + 0.2);
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω
        function runMic(target) {
            const R = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!R) { alert("–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ"); return; }
            
            const r = new R();
            r.lang = 'ru-RU';
            
            const inputId = (target === 'art') ? 'i-art' : 'i-chat';
            const btnId = (target === 'art') ? 'm-btn-art' : 'm-btn';
            const btn = document.getElementById(btnId);

            r.onstart = () => {
                playBeep();
                btn.classList.add('mic-active');
            };

            r.onresult = (e) => {
                const text = e.results[0][0].transcript;
                document.getElementById(inputId).value = text;
                if (target === 'art') genArt(); else sendMsg();
            };

            r.onend = () => {
                btn.classList.remove('mic-active');
            };

            r.start();
        }

        function genArt() {
            const val = document.getElementById('i-art').value;
            if(!val) return;
            document.getElementById('art-container').innerHTML += `<p>üé® –†–∏—Å—É—é: ${val}...</p>`;
            document.getElementById('i-art').value = '';
        }

        function sendMsg() {
            const val = document.getElementById('i-chat').value;
            if(!val) return;
            document.getElementById('chat-box').innerHTML += `<p>üë§: ${val}</p>`;
            document.getElementById('i-chat').value = '';
        }
    </script>
</body>
</html>
