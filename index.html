<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BOSS AI STUDIO: ULTIMATE</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #0b0b0e; --card-bg: #16161a; --text-color: #e0e0e0;
            --accent-color: #ff0055; --accent-grad: linear-gradient(135deg, #ff0055, #ff5500);
            --input-bg: #222226; --border-radius: 20px;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; }
        
        .book { width: 100%; max-width: 500px; height: 100vh; position: relative; transition: transform 0.6s cubic-bezier(0.2, 0, 0.2, 1); transform-style: preserve-3d; }
        .book.flipped { transform: rotateY(-180deg); }

        .page { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: var(--card-bg); display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(0,0,0,0.5); border: 1px solid #333; }
        .page.back { transform: rotateY(180deg); }

        .content { padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        .header { text-align: center; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .banner-img { width: 100%; height: 80px; border-radius: 12px; object-fit: cover; border: 1px solid var(--accent-color); }
        
        /* –°–°–´–õ–ö–ê –ù–ê –ö–ê–ù–ê–õ */
        .channel-link { text-decoration: none; color: inherit; display: block; }
        .channel-title { font-weight: 900; text-transform: uppercase; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 22px; margin: 5px 0; }
        .nav-info { font-size: 9px; color: #555; text-transform: uppercase; margin-top: 5px; }

        .presets { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; }
        .preset-btn { background: #222; border: 1px solid #444; color: #aaa; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 10px; white-space: nowrap; }

        textarea, input, select { background: var(--input-bg); border: 1px solid #333; color: white; padding: 12px; border-radius: 12px; width: 100%; box-sizing: border-box; font-size: 14px; outline: none; }
        
        .action-btn { background: var(--accent-grad); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 900; cursor: pointer; }
        .secondary-btn { background: #333; border: none; color: #ccc; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 11px; }

        #image-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .img-wrapper { position: relative; }
        .img-wrapper img { width: 100%; border-radius: 10px; border: 1px solid #333; }

        #chat-container { flex: 1; background: #08080a; border-radius: 15px; padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; border: 1px solid #222; }
        .msg { padding: 12px; border-radius: 15px; font-size: 14px; max-width: 85%; }
        .msg.user { align-self: flex-end; background: var(--accent-color); }
        .msg.ai { align-self: flex-start; background: #2a2a2e; border: 1px solid #3d3d42; }

        .recording { background: #ff0000 !important; animation: pulse 1.2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,0,85,0.6); } 70% { box-shadow: 0 0 0 10px rgba(255,0,85,0); } 100% { box-shadow: 0 0 0 0 rgba(255,0,85,0); } }
    </style>
</head>
<body>

<div class="book" id="myBook">
    <div class="page front">
        <div class="content">
            <div class="header">
                <a href="https://www.youtube.com/user/aivimek" target="_blank" class="channel-link">
                    <img src="1768422265866.jpg" class="banner-img" onerror="this.src='https://via.placeholder.com/500x100?text=BOSS+TRUCKS'">
                    <div class="channel-title">–û–¢ –ò–ì–†–£–®–ö–ò –î–û –§–£–†–´</div>
                </a>
                <div class="nav-info">‚¨Ö –°–≤–∞–π–ø –≤–ª–µ–≤–æ –¥–ª—è —á–∞—Ç–∞</div>
            </div>

            <div style="display:flex; gap:5px;">
                <select id="model-select" style="flex:1">
                    <option value="flux">üíé Flux (–ö–∞—á–µ—Å—Ç–≤–æ)</option>
                    <option value="flux-realism">üì∏ Realism (–§–æ—Ç–æ)</option>
                </select>
                <button class="secondary-btn" onclick="downloadAll()">üì• –í—Å—ë</button>
                <button class="secondary-btn" onclick="clearBoard()">üóëÔ∏è</button>
            </div>

            <div class="presets">
                <button class="preset-btn" onclick="addP('KAMAZ K5 truck, cinematic lighting, 8k')">üöõ –ö–∞–º–ê–ó K5</button>
                <button class="preset-btn" onclick="addP('Heavy truck on mountain road, realistic')">üèîÔ∏è –ì–æ—Ä—ã</button>
                <button class="preset-btn" onclick="addP('Toy truck macro photography, bright colors')">üß∏ –ò–≥—Ä—É—à–∫–∞</button>
            </div>

            <textarea id="prompt-input" rows="2" placeholder="–ß—Ç–æ —Ä–∏—Å—É–µ–º, –±–æ—Å—Å?"></textarea>
            
            <div style="display:flex; gap:5px;">
                <button id="v-art" class="action-btn" style="flex:1" onclick="runVoice('art')">üé§ –ì–û–õ–û–° + –ê–í–¢–û</button>
                <button class="action-btn" style="background:#444" onclick="generateImage()">üöÄ</button>
            </div>

            <div id="image-container"></div>
        </div>
    </div>

    <div class="page back">
        <div class="content">
            <div class="header">
                <div class="nav-info">–°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –¥–ª—è –∞—Ä—Ç–æ–≤ ‚Æï</div>
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <select id="chat-model-select">
                        <option value="openai">ü§ñ ChatGPT</option>
                        <option value="llama">ü¶ô Llama 3</option>
                        <option value="mistral">üåÄ Mistral</option>
                    </select>
                    <button class="secondary-btn" onclick="clearChat()">üóëÔ∏è</button>
                </div>
            </div>

            <div id="chat-container"></div>

            <div style="display:flex; gap:5px;">
                <button id="v-chat" class="secondary-btn" style="width:55px; font-size:20px" onclick="runVoice('chat')">üé§</button>
                <input type="text" id="chat-input" placeholder="–°–ø—Ä–æ—Å–∏ —É –±–æ—Ç–∞..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()" class="action-btn" style="width:55px; padding:0">‚û§</button>
            </div>
            <button class="secondary-btn" style="font-size:10px" onclick="window.speechSynthesis.cancel()">üîá –°–¢–û–ü –ì–û–õ–û–°</button>
        </div>
    </div>
</div>

<script>
    const book = document.getElementById('myBook');
    let tX = 0;

    // –°–í–ê–ô–ü–´
    document.addEventListener('touchstart', e => tX = e.touches[0].clientX);
    document.addEventListener('touchend', e => {
        const d = tX - e.changedTouches[0].clientX;
        if (d > 80 && !book.classList.contains('flipped')) book.classList.add('flipped');
        if (d < -80 && book.classList.contains('flipped')) book.classList.remove('flipped');
    });

    function addP(t) { document.getElementById('prompt-input').value = t; }

    window.onload = () => {
        const saved = JSON.parse(localStorage.getItem('boss_gallery') || '[]');
        saved.forEach(url => renderImg(url));
    };

    function renderImg(url) {
        const wrap = document.createElement('div');
        wrap.className = 'img-wrapper';
        wrap.innerHTML = `<img src="${url}" onclick="window.open('${url}')"><button style="position:absolute;top:5px;right:5px;background:red;color:white;border:none;border-radius:50%;width:20px;height:20px;" onclick="delImg('${url}', this)">√ó</button>`;
        document.getElementById('image-container').prepend(wrap);
    }

    // –ì–û–õ–û–°
    function runVoice(mode) {
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.lang = 'ru-RU';
        const btn = document.getElementById(mode === 'art' ? 'v-art' : 'v-chat');
        rec.onstart = () => btn.classList.add('recording');
        rec.onend = () => btn.classList.remove('recording');
        rec.onresult = async (e) => {
            const txt = e.results[0][0].transcript;
            if (mode === 'art') {
                document.getElementById('prompt-input').value = "‚è≥ –ü–µ—Ä–µ–≤–æ–¥...";
                const trans = await translate(txt);
                document.getElementById('prompt-input').value = trans;
                generateImage();
            } else {
                document.getElementById('chat-input').value = txt;
                sendMessage();
            }
        };
        rec.start();
    }

    async function translate(t) {
        try {
            const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=ru&tl=en&dt=t&q=${encodeURIComponent(t)}`);
            const d = await r.json(); return d[0][0][0];
        } catch { return t; }
    }

    // –ß–ê–¢
    async function sendMessage() {
        const inp = document.getElementById('chat-input');
        const box = document.getElementById('chat-container');
        const model = document.getElementById('chat-model-select').value;
        const msg = inp.value.trim();
        if(!msg) return;

        box.innerHTML += `<div class="msg user">${msg}</div>`;
        inp.value = '';
        const loader = document.createElement('div');
        loader.className = 'msg ai'; loader.innerText = '‚è≥...';
        box.appendChild(loader);
        box.scrollTop = box.scrollHeight;

        try {
            const r = await fetch(`https://text.pollinations.ai/${encodeURIComponent(msg)}?model=${model}`);
            const t = await r.text();
            loader.innerHTML = marked.parse(t);
            const s = new SpeechSynthesisUtterance(t.replace(/[#*`]/g, ''));
            s.lang = 'ru-RU'; window.speechSynthesis.speak(s);
        } catch { loader.innerText = "–°–µ—Ä–≤–µ—Ä 502."; }
        box.scrollTop = box.scrollHeight;
    }

    // –ê–†–¢
    function generateImage() {
        const p = document.getElementById('prompt-input').value;
        const m = document.getElementById('model-select').value;
        if(!p || p.includes('‚è≥')) return;
        const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?model=${m}&seed=${Math.random()}&nologo=true`;
        
        let saved = JSON.parse(localStorage.getItem('boss_gallery') || '[]');
        saved.push(url);
        localStorage.setItem('boss_gallery', JSON.stringify(saved.slice(-40)));
        renderImg(url);
    }

    function delImg(url, btn) {
        let saved = JSON.parse(localStorage.getItem('boss_gallery') || '[]');
        localStorage.setItem('boss_gallery', JSON.stringify(saved.filter(i => i !== url)));
        btn.parentElement.remove();
    }

    function clearBoard() { localStorage.removeItem('boss_gallery'); document.getElementById('image-container').innerHTML = ''; }
    function clearChat() { document.getElementById('chat-container').innerHTML = ''; }
    
    async function downloadAll() {
        const saved = JSON.parse(localStorage.getItem('boss_gallery') || '[]');
        for(let i=0; i<saved.length; i++) {
            const a = document.createElement('a'); a.href = saved[i]; a.download = `boss_art_${i}.jpg`;
            a.click(); await new Promise(r => setTimeout(r, 500));
        }
    }
</script>
</body>
</html>
