<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ULTRA ‚Äî BOSS TRANSLATE EDITION</title>
    
    <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --paper: #f4e4bc; --ink: #2c241a; --gold: #d4af37; --accent: #8b0000; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; font-family: "Georgia", serif; }
        .viewport { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        #book-container { box-shadow: 0 0 50px rgba(0,0,0,0.8); z-index: 1; }
        .page { background: var(--paper); }
        .paper-sheet { background: var(--paper); background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png'); display: flex; flex-direction: column; height: 100%; width: 100%; border: 1px solid rgba(0,0,0,0.1); }
        
        /* –§–∏–∫—Å –∫–Ω–æ–ø–æ–∫: –≤—ã–Ω–æ—Å–∏–º –∏—Ö "–Ω–∞–¥" –∫–Ω–∏–≥–æ–π */
        .input-bar { 
            padding: 12px; background: #e8d5a7; display: flex; gap: 10px; align-items: center; 
            border-top: 2px solid var(--ink); position: relative; z-index: 9999 !important; pointer-events: auto !important;
        }
        .field { flex: 1; background: #fff; border: 1px solid #aaa; padding: 12px; border-radius: 25px; outline: none; font-size: 16px; pointer-events: auto !important; }
        .btn { background: none; border: none; font-size: 22px; cursor: pointer; color: var(--ink); pointer-events: auto !important; }

        .scroll-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; touch-action: pan-y; }
        .cover-front { background: #2b0000; border: 8px double var(--gold); display: flex; flex-direction: column; height: 100%; }
        .v-box { width: 100%; height: 60%; background: #000; border-bottom: 4px solid var(--gold); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .v-box video { width: 100%; height: 100%; object-fit: cover; }
        .c-text { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--gold); text-align: center; }
        
        .mic-active { color: var(--accent) !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="viewport">
    <div id="book-container">
        <div class="page" data-density="hard">
            <div class="cover-front">
                <div class="v-box"><video autoplay loop muted playsinline><source src="https://raw.githubusercontent.com/garik964186-blip/ai-truck-studio/main/1768452401066.mp4" type="video/mp4"></video></div>
                <div class="c-text"><h1>ULTRA</h1><p>–ö–ù–ò–ì–ê –ë–û–°–°–ê</p></div>
            </div>
        </div>
        <div class="page">
            <div class="paper-sheet">
                <div style="padding:10px; text-align:center; font-weight:bold; border-bottom:1px solid #222;">üîÆ –£–ú–ù–´–ô –ß–ê–¢ (AUTO-TRANS)</div>
                <div id="hub-box" class="scroll-area"></div>
                <div class="input-bar">
                    <button id="btn-mic-hub" onclick="startMic('i-hub', 'btn-mic-hub', sendMsg)" class="btn"><i class="fas fa-microphone"></i></button>
                    <input type="text" id="i-hub" class="field" placeholder="–°–ø—Ä–æ—Å–∏ –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ...">
                    <button onclick="sendMsg()" class="btn"><i class="fas fa-paper-plane" style="color:var(--accent)"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let pageFlip;
    const flipSound = new Audio('https://www.soundjay.com/misc/sounds/page-flip-01a.mp3');
    let isPaused = false;

    document.addEventListener('DOMContentLoaded', () => {
        pageFlip = new St.PageFlip(document.getElementById("book-container"), {
            width: 400, height: 700, size: "stretch", showCover: true,
            swipeDistance: 30, clickEventForward: true, usePortrait: true,
            interactive: true 
        });
        pageFlip.loadFromHTML(document.querySelectorAll(".page"));
        pageFlip.on('flip', () => { flipSound.currentTime = 0; flipSound.play(); });

        document.body.addEventListener('click', (e) => {
            if (e.target.closest('.input-bar')) return;
            if (window.speechSynthesis.speaking) {
                if (isPaused) { window.speechSynthesis.resume(); isPaused = false; }
                else { window.speechSynthesis.pause(); isPaused = true; }
            }
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏)
    async function translateText(text) {
        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–µ–π—Ä–æ—Å–µ—Ç–∏-–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫—É, —á—Ç–æ–±—ã –æ–Ω–∞ —Å–¥–µ–ª–∞–ª–∞ prompt –∏–¥–µ–∞–ª—å–Ω—ã–º –¥–ª—è AI
            const res = await fetch(`https://text.pollinations.ai/prompt/Translate to English only: ${encodeURIComponent(text)}?model=openai`);
            return await res.text();
        } catch (e) {
            return text; // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
        }
    }

    async function sendMsg() {
        const i = document.getElementById('i-hub'), b = document.getElementById('hub-box');
        if(!i.value) return;
        const userText = i.value; 
        i.value = '';
        
        b.innerHTML = `<div style="margin-bottom:10px; opacity:0.7;"><i>–ü–µ—Ä–µ–≤–æ–∂—É –∑–∞–ø—Ä–æ—Å...</i></div>` + b.innerHTML;
        
        // 1. –ü–µ—Ä–µ–≤–æ–¥–∏–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
        const translatedPrompt = await translateText(userText);
        
        b.innerHTML = `<div style="margin-bottom:10px;"><b>–í—ã:</b> ${userText}</div>` + b.innerHTML.replace('<i>–ü–µ—Ä–µ–≤–æ–∂—É –∑–∞–ø—Ä–æ—Å...</i>', '');

        try {
            // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–µ–π—Ä–æ—Å–µ—Ç—å –ø–æ–π–º–µ—Ç –µ–≥–æ –ª—É—á—à–µ)
            const res = await fetch(`https://text.pollinations.ai/prompt/${encodeURIComponent(translatedPrompt)}?model=openai`);
            const data = await res.text();
            
            b.innerHTML = `<div style="border-bottom:1px dashed #ccc; padding-bottom:10px; margin-bottom:15px;"><b>AI:</b> ${marked.parse(data)}</div>` + b.innerHTML;
            speak(data);
        } catch(e) { b.innerHTML = "<div>–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏...</div>" + b.innerHTML; }
    }

    function startMic(inputId, btnId, callback) {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Speech) return alert("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å");
        const rec = new Speech();
        rec.lang = 'ru-RU';
        const btn = document.getElementById(btnId);
        rec.onstart = () => btn.classList.add('mic-active');
        rec.onresult = (e) => { document.getElementById(inputId).value = e.results[0][0].transcript; callback(); };
        rec.onend = () => btn.classList.remove('mic-active');
        rec.start();
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        isPaused = false;
        const msg = new SpeechSynthesisUtterance(text.replace(/[#*`_]/g, ''));
        msg.lang = 'ru-RU';
        window.speechSynthesis.speak(msg);
    }
</script>
</body>
</html>
