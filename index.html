<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ULTRA — ALBUM</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { 
            --paper: #f4e4bc; 
            --ink: #2c241a;   
            --accent: #8b0000; 
        }

        body, html { margin: 0; padding: 0; height: 100%; background: #1a1a1a; overflow: hidden; font-family: "Georgia", serif; }
        .viewport { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; perspective: 2500px; }
        .book { width: 92vw; max-width: 400px; height: 82vh; position: relative; transform-style: preserve-3d; box-shadow: 0 50px 100px rgba(0,0,0,0.9); }

        .page { position: absolute; width: 100%; height: 100%; top: 0; left: 0; transform-origin: left; transform-style: preserve-3d; transition: transform 1.3s cubic-bezier(0.645, 0.045, 0.355, 1); }
        .paper-sheet { 
            background: var(--paper); 
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: var(--ink); display: flex; flex-direction: column; height: 100%; 
            box-shadow: inset 3px 0 10px rgba(0,0,0,0.1); 
        }

        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 0 5px 5px 0; overflow: hidden; }
        .back { transform: rotateY(180deg); background: #e8d5a7; border-radius: 5px 0 0 5px; box-shadow: inset 20px 0 40px rgba(0,0,0,0.2); }
        .flipped { transform: rotateY(-170deg) skewY(-1.5deg); }

        .header { padding: 15px; background: rgba(0,0,0,0.03); border-bottom: 1px solid rgba(0,0,0,0.1); text-align: center; font-weight: bold; text-transform: uppercase; }
        
        /* ЗОНА АЛЬБОМА */
        .scroll-area { 
            flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 25px; 
            touch-action: pan-y; -webkit-overflow-scrolling: touch; 
        }

        /* Стиль вклеенного фото */
        .photo-frame {
            background: white;
            padding: 10px 10px 30px 10px;
            box-shadow: 2px 5px 15px rgba(0,0,0,0.3);
            transform: rotate(calc(var(--r, 0) * 1deg)); /* Легкий случайный наклон */
            border: 1px solid #ddd;
        }
        .photo-frame img { width: 100%; display: block; filter: sepia(0.2); }
        .photo-caption { font-size: 12px; margin-top: 10px; text-align: center; color: #555; font-style: italic; }

        .input-bar { padding: 15px; background: rgba(0,0,0,0.05); display: flex; gap: 10px; border-top: 1px solid rgba(0,0,0,0.1); }
        .field { flex: 1; background: rgba(255,255,255,0.5); border: 1px solid rgba(0,0,0,0.2); color: var(--ink); padding: 12px; border-radius: 5px; outline: none; }
        
        .msg { padding: 10px 0; border-bottom: 1px dashed rgba(0,0,0,0.1); font-size: 15px; }

        .cover-front { background: linear-gradient(135deg, #4b0000 0%, #2a0000 100%); border: 8px double #d4af37; color: #d4af37; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div class="viewport">
    <div class="book">

        <div class="page" id="p3" style="z-index: 1;">
            <div class="front paper-sheet">
                <div class="header">Дневник</div>
                <div class="scroll-area" id="chat-box"></div>
                <div class="input-bar">
                    <input type="text" id="i-chat" class="field" placeholder="Запись..." onkeypress="if(event.key==='Enter') sendMessage()">
                </div>
            </div>
            <div class="back"></div>
        </div>

        <div class="page" id="p2" style="z-index: 2;">
            <div class="front paper-sheet">
                <div class="header">Альбом эскизов</div>
                <div class="scroll-area" id="imgs-box">
                    <div id="loader" style="display:none; text-align:center; font-style:italic; color:var(--accent);">
                        <i class="fas fa-pen-nib fa-spin"></i> Рисую новый эскиз...
                    </div>
                </div>
                <div class="input-bar">
                    <input type="text" id="i-art" class="field" placeholder="Опишите образ...">
                    <button onclick="genArt()" style="background:var(--accent); border:none; color:white; padding:10px 15px; border-radius:5px;"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="back"></div>
        </div>

        <div class="page" id="p1" style="z-index: 3;">
            <div class="front cover-front">
                <i class="fas fa-images" style="font-size: 60px; margin-bottom: 20px;"></i>
                <h1 style="margin:0;">ULTRA</h1>
                <p>АРХИВ ИЗОБРАЖЕНИЙ</p>
                <div style="margin-top: 60px; font-style: italic;">Листнуть...</div>
            </div>
            <div class="back"></div>
        </div>

    </div>
</div>

<script>
    let startX = 0, startY = 0, currentStep = 1;

    document.addEventListener('touchstart', e => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; });
    document.addEventListener('touchend', e => {
        let diffX = startX - e.changedTouches[0].clientX;
        let diffY = startY - e.changedTouches[0].clientY;
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
            if (diffX > 0 && currentStep < 3) { document.getElementById('p' + currentStep).classList.add('flipped'); currentStep++; }
            else if (diffX < 0 && currentStep > 1) { currentStep--; document.getElementById('p' + currentStep).classList.remove('flipped'); }
        }
    });

    async function genArt() {
        const input = document.getElementById('i-art');
        const box = document.getElementById('imgs-box');
        const loader = document.getElementById('loader');
        const val = input.value; if(!val) return;
        
        input.value = '';
        loader.style.display = 'block';
        
        const randomRotation = (Math.random() * 4 - 2).toFixed(1); // Случайный наклон от -2 до 2 градусов
        const seed = Math.floor(Math.random() * 1000000);
        const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(val)}?nologo=true&seed=${seed}`;
        
        const img = new Image();
        img.src = url;
        img.onload = () => {
            loader.style.display = 'none';
            const frame = document.createElement('div');
            frame.className = 'photo-frame';
            frame.style.setProperty('--r', randomRotation);
            frame.innerHTML = `
                <img src="${url}">
                <div class="photo-caption">${val}</div>
            `;
            // Добавляем в начало альбома, но после лоадера
            box.insertBefore(frame, loader.nextSibling);
            box.scrollTop = 0;
        };
    }

    // Логика чата (упрощенно для примера)
    async function sendMessage() {
        const box = document.getElementById('chat-box');
        const input = document.getElementById('i-chat');
        const val = input.value; if(!val) return;
        input.value = '';
        box.innerHTML = `<div class="msg"><b>Вы:</b> ${val}</div>` + box.innerHTML;
        const res = await fetch(`https://text.pollinations.ai/prompt/${encodeURIComponent(val)}`);
        const data = await res.text();
        box.innerHTML = `<div class="msg"><b>Дух книги:</b> ${data}</div>` + box.innerHTML;
    }
</script>
</body>
</html>
