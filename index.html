<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ù–ê–®–ê –ö–ù–ò–ì–ê | BOSS FINAL</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/pinch-zoom-js@2.3.4/dist/pinch-zoom.umd.js"></script>
    
    <style>
        /* === –ë–õ–û–ö–ò–†–û–í–ö–ê –õ–ò–®–ù–ò–• –ñ–ï–°–¢–û–í –ë–†–ê–£–ó–ï–†–ê === */
        :root { --paper: #f4e4bc; --ink: #2c241a; --gold: #d4af37; --accent: #8b0000; --leather: #2a0505; --highlight: rgba(255, 215, 0, 0.4); }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100dvh; 
            background: #000; overflow: hidden; 
            font-family: "Georgia", serif; 
            /* –≠–¢–û –ó–ê–ü–†–ï–©–ê–ï–¢ –ë–†–ê–£–ó–ï–†–£ –ü–ï–†–ï–•–í–ê–¢–´–í–ê–¢–¨ –°–í–ê–ô–ü–´: */
            touch-action: none; 
            user-select: none;
        }

        /* 3D –°—Ü–µ–Ω–∞ */
        .viewport { width: 100vw; height: 100dvh; position: relative; perspective: 2500px; overflow: hidden; }
        .book { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; }
        
        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page { 
            position: absolute; width: 100%; height: 100%; top: 0; left: 0; 
            transform-origin: left; transform-style: preserve-3d; 
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1); 
            background: #fff; /* –ó–∞–≥–ª—É—à–∫–∞ –æ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ */
        }
        
        /* Z-Index: –û–±–ª–æ–∂–∫–∞ (p1) —Å–∞–º–∞—è –≤–µ—Ä—Ö–Ω—è—è */
        #p1 { z-index: 4; }
        #p2 { z-index: 3; }
        #p3 { z-index: 2; }
        #p4 { z-index: 1; }

        /* –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ */
        .flipped { transform: rotateY(-180deg) !important; pointer-events: none; }
        
        /* –ë—É–º–∞–≥–∞ */
        .paper-sheet { 
            background: var(--paper); 
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png'); 
            color: var(--ink); display: flex; flex-direction: column; height: 100%; 
            box-shadow: inset 10px 0 30px rgba(0,0,0,0.1); 
            position: relative;
        }

        /* –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ */
        .back { position: absolute; inset: 0; transform: rotateY(180deg); backface-visibility: hidden; background: #e8d5a7; }

        /* === –ò–ù–¢–ï–†–§–ï–ô–° === */
        .header { padding: 10px; background: rgba(0,0,0,0.05); border-bottom: 2px solid var(--ink); display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .header-btn { border: none; background: none; font-size: 20px; color: var(--accent); padding: 10px; }
        
        .scroll-area { flex: 1; overflow-y: auto; padding: 15px; -webkit-overflow-scrolling: touch; touch-action: pan-y; } /* –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        
        .ai-select { width: 90%; margin: 10px auto; padding: 10px; display: block; border: 2px solid var(--ink); border-radius: 8px; background: #fff; font-size: 16px; }
        
        .input-bar { padding: 10px; background: rgba(255,255,255,0.5); border-top: 1px solid rgba(0,0,0,0.1); padding-bottom: calc(10px + env(safe-area-inset-bottom)); }
        .row { display: flex; gap: 8px; }
        .field { flex: 1; padding: 10px; border: 2px solid var(--ink); border-radius: 20px; font-size: 16px; outline: none; }
        .btn { border: none; background: none; font-size: 22px; color: var(--ink); padding: 0 10px; }

        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .ai-box { padding: 10px; border-bottom: 1px dashed #ccc; font-size: 15px; }
        .user-msg { text-align: right; color: var(--accent); font-style: italic; margin: 5px 0; font-size: 14px; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–¢–æ—á–∫–∏) */
        .nav-dots { position: fixed; bottom: 80px; width: 100%; text-align: center; pointer-events: none; z-index: 5000; }
        .dot { display: inline-block; width: 12px; height: 12px; background: var(--gold); border-radius: 50%; margin: 0 5px; opacity: 0.4; border: 1px solid #000; transition: 0.3s; pointer-events: auto; }
        .dot.active { opacity: 1; transform: scale(1.2); background: var(--accent); }

        /* –ê—É–¥–∏–æ –ø–ª–µ–µ—Ä */
        .audio-controls { display: flex; justify-content: center; gap: 20px; margin: 10px 0; }
        .audio-btn { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--ink); background: #fff; font-size: 18px; }
        .active-sentence { background: var(--highlight); }

        /* –ó—É–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
        #z-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 10000; display: none; align-items: center; justify-content: center; }
    </style>
</head>
<body onclick="wakeAudio()">

<div id="z-overlay" onclick="closeZ()">
    <img id="z-img" src="" style="max-width:100%; max-height:100%;">
</div>

<div class="nav-dots">
    <div class="dot active" onclick="jumpTo(1)"></div>
    <div class="dot" onclick="jumpTo(2)"></div>
    <div class="dot" onclick="jumpTo(3)"></div>
    <div class="dot" onclick="jumpTo(4)"></div>
</div>

<div class="viewport">
    <div class="book">
        
        <div class="page" id="p4">
            <div class="paper-sheet">
                <div class="header">
                    <button class="header-btn" onclick="clearBook()"><i class="fas fa-trash"></i></button>
                    <span>–ê–£–î–ò–û–ö–ù–ò–ì–ê</span>
                    <span style="width:30px"></span>
                </div>
                <div class="scroll-area">
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="bookPrev()"><i class="fas fa-backward"></i></button>
                        <button class="audio-btn" onclick="togglePlayBook()" id="play-btn"><i class="fas fa-play"></i></button>
                        <button class="audio-btn" onclick="bookNext()"><i class="fas fa-forward"></i></button>
                    </div>
                    <div id="book-content" style="font-size:18px; line-height:1.6;"></div>
                    <div id="book-placeholder" style="text-align:center; opacity:0.5; margin-top:50px;">
                        –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ,<br>—è –ø—Ä–æ—á–∏—Ç–∞—é –µ–≥–æ.
                    </div>
                </div>
                <div class="input-bar">
                    <div class="row">
                        <input id="i-book" class="field" placeholder="–¢–µ–∫—Å—Ç —Å—é–¥–∞...">
                        <button onclick="loadBook()" class="btn"><i class="fas fa-upload"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="p3">
            <div class="paper-sheet">
                <div class="header">
                    <button class="header-btn" onclick="clearChat()"><i class="fas fa-trash"></i></button>
                    <span>–ò–ù–¢–ï–õ–õ–ï–ö–¢-–•–ê–ë</span>
                    <span style="width:30px"></span>
                </div>
                <select id="chat-model" class="ai-select">
                    <option value="openai">GPT-4o</option>
                    <option value="mistral">Mistral Large</option>
                </select>
                <div id="hub-box" class="scroll-area"></div>
                <div class="input-bar">
                    <div class="row">
                        <input id="i-chat" class="field" placeholder="–í–æ–ø—Ä–æ—Å...">
                        <button onclick="sendMsg()" class="btn"><i class="fas fa-paper-plane" style="color:var(--accent)"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="p2">
            <div class="paper-sheet">
                <div class="header">
                    <button class="header-btn" onclick="clearArt()"><i class="fas fa-trash"></i></button>
                    <span>–í–ò–ó–£–ê–õ–ò–ó–ê–¢–û–†</span>
                    <span style="width:30px"></span>
                </div>
                <select id="art-model" class="ai-select"><option value="flux">FLUX.1 (Realism)</option><option value="midjourney">Midjourney Style</option></select>
                <div id="imgs-box" class="scroll-area"></div>
                <div class="input-bar">
                    <div class="row">
                        <input id="i-art" class="field" placeholder="–ß—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å?">
                        <button onclick="genArt()" class="btn"><i class="fas fa-magic" style="color:var(--accent)"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="p1" onclick="jumpTo(2)">
            <div class="paper-sheet" style="background:var(--leather); border:10px double var(--gold); justify-content:center; align-items:center;">
                <div style="width:90%; padding:10px; background:#fff; transform: rotate(-2deg); box-shadow: 0 20px 40px rgba(0,0,0,0.6);">
                    <video autoplay loop muted playsinline style="width:100%; display:block;">
                        <source src="https://raw.githubusercontent.com/garik964186-blip/ai-truck-studio/main/1768452401066.mp4" type="video/mp4">
                    </video>
                </div>
                
                <div style="text-align:center; margin-top:30px; color:var(--gold);">
                    <h1 style="margin:0; font-size:32px; letter-spacing:3px; text-shadow: 2px 2px 0 #000;">–ù–ê–®–ê –ö–ù–ò–ì–ê</h1>
                    <p style="opacity:0.7; font-size:12px;">BOSS EDITION</p>
                    
                    <div style="margin-top:40px; border: 1px solid var(--gold); padding: 10px; border-radius: 20px; animation: pulse 2s infinite;">
                        üëÜ –ù–ê–ñ–ú–ò –ò–õ–ò –°–í–ê–ô–ü–ù–ò ‚Üê
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    let step = 1;
    let audioReady = false;
    const flipSound = new Audio('https://raw.githubusercontent.com/garik964186-blip/ai-truck-studio/main/page-flip-sound.mp3');

    // === –ü–ï–†–ï–õ–ò–°–¢–´–í–ê–ù–ò–ï (–°–í–ê–ô–ü + –ö–õ–ò–ö) ===
    function jumpTo(s) {
        if(s === step) return;
        
        // –ó–≤—É–∫
        flipSound.currentTime = 0; 
        flipSound.play().catch(()=>{});
        if(navigator.vibrate) navigator.vibrate(20);

        // –ê–Ω–∏–º–∞—Ü–∏—è
        for(let i=1; i<=3; i++) {
            const p = document.getElementById('p'+i);
            if(s > i) p.classList.add('flipped');
            else p.classList.remove('flipped');
        }

        // –¢–æ—á–∫–∏
        document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === s-1));
        step = s;
    }

    // === –£–õ–£–ß–®–ï–ù–ù–´–ô –°–ï–ù–°–û–† –°–í–ê–ô–ü–û–í ===
    let startX = 0;
    document.addEventListener('touchstart', e => {
        startX = e.touches[0].clientX;
    }, {passive: false}); // passive: false –≤–∞–∂–Ω–æ –¥–ª—è iOS

    document.addEventListener('touchend', e => {
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –∑—É–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ - –Ω–µ —Å–≤–∞–π–ø–∞–µ–º
        if(document.getElementById('z-overlay').style.display === 'flex') return;

        let endX = e.changedTouches[0].clientX;
        let diff = startX - endX;

        // –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 50px
        if (Math.abs(diff) > 50) {
            if (diff > 0 && step < 4) jumpTo(step + 1); // –í–ª–µ–≤–æ (–≤–ø–µ—Ä–µ–¥)
            else if (diff < 0 && step > 1) jumpTo(step - 1); // –í–ø—Ä–∞–≤–æ (–Ω–∞–∑–∞–¥)
        }
    }, {passive: false});


    // === –õ–û–ì–ò–ö–ê –ê–£–î–ò–û–ö–ù–ò–ì–ò ===
    let book = { text: [], idx: 0, play: false, synth: window.speechSynthesis };

    function wakeAudio() { if(!audioReady) { book.synth.speak(new SpeechSynthesisUtterance('')); audioReady=true; } }

    function loadBook() {
        let val = document.getElementById('i-book').value;
        if(!val) return;
        // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        book.text = val.match(/[^.!?]+[.!?]+["']?|[\s\S]+$/g) || [val];
        book.idx = 0;
        document.getElementById('book-content').innerHTML = book.text.map((t,i)=>`<span id="s${i}">${t} </span>`).join('');
        document.getElementById('book-placeholder').style.display='none';
        document.getElementById('i-book').value = '';
        alert('–ó–∞–≥—Ä—É–∂–µ–Ω–æ! –ñ–º–∏ Play.');
    }

    function togglePlayBook() {
        if(book.text.length===0) return;
        book.play = !book.play;
        document.getElementById('play-btn').innerHTML = book.play ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
        if(book.play) speak(); else book.synth.cancel();
    }

    function speak() {
        if(!book.play || book.idx >= book.text.length) { book.play=false; return; }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞
        document.querySelectorAll('.active-sentence').forEach(e=>e.classList.remove('active-sentence'));
        let el = document.getElementById('s'+book.idx);
        if(el) { el.classList.add('active-sentence'); el.scrollIntoView({block:"center", behavior:"smooth"}); }

        book.synth.cancel();
        let u = new SpeechSynthesisUtterance(book.text[book.idx]);
        u.lang = 'ru-RU';
        u.onend = () => { if(book.play) { book.idx++; speak(); } };
        book.synth.speak(u);
    }
    
    function bookNext() { if(book.idx < book.text.length-1) { book.idx++; speak(); } }
    function bookPrev() { if(book.idx > 0) { book.idx--; speak(); } }
    function clearBook() { book.play=false; book.synth.cancel(); book.text=[]; document.getElementById('book-content').innerHTML=''; document.getElementById('book-placeholder').style.display='block'; }

    // === –õ–û–ì–ò–ö–ê AI –ß–ê–¢–ê ===
    async function sendMsg() {
        let i = document.getElementById('i-chat'), val = i.value, b = document.getElementById('hub-box');
        if(!val) return;
        i.value = '';
        b.innerHTML += `<div class="user-msg">${val}</div>`;
        
        // –ü–µ—Ä–µ–≤–æ–¥ –¥–ª—è AI (—á—Ç–æ–±—ã –æ–Ω –ø–æ–Ω–∏–º–∞–ª –ª—É—á—à–µ)
        let en = val; 
        try { let r = await fetch(`https://api.mymemory.translated.net/get?q=${val}&langpair=ru|en`); let j = await r.json(); en = j.responseData.translatedText; } catch(e){}

        let url = `https://text.pollinations.ai/prompt/${encodeURIComponent("Respond in Russian briefly: "+en)}?model=${document.getElementById('chat-model').value}`;
        
        try {
            let r = await fetch(url);
            let txt = await r.text();
            b.innerHTML += `<div class="ai-box"><b>AI:</b> ${marked.parse(txt)}</div>`;
            b.scrollTop = b.scrollHeight;
        } catch(e) { b.innerHTML += `<div class="ai-box">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏</div>`; }
    }

    // === –õ–û–ì–ò–ö–ê –†–ò–°–û–í–ê–ù–ò–Ø ===
    async function genArt() {
        let i = document.getElementById('i-art'), val = i.value, b = document.getElementById('imgs-box');
        if(!val) return;
        i.value = '';
        
        // –ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞
        let en = val;
        try { let r = await fetch(`https://api.mymemory.translated.net/get?q=${val}&langpair=ru|en`); let j = await r.json(); en = j.responseData.translatedText; } catch(e){}

        let url = `https://image.pollinations.ai/prompt/${encodeURIComponent(en)}?model=${document.getElementById('art-model').value}&nologo=true&seed=${Math.random()}`;
        b.innerHTML = `<img src="${url}" style="width:100%; border-radius:10px; margin-bottom:10px; box-shadow:0 5px 15px rgba(0,0,0,0.3);" onclick="openZ(this.src)">` + b.innerHTML;
    }

    function clearChat() { document.getElementById('hub-box').innerHTML=''; }
    function clearArt() { document.getElementById('imgs-box').innerHTML=''; }
    function openZ(src) { document.getElementById('z-img').src=src; document.getElementById('z-overlay').style.display='flex'; }
    function closeZ() { document.getElementById('z-overlay').style.display='none'; }
</script>
</body>
</html>
