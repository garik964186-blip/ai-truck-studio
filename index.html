<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI Book: BOSS PRO Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #0b0b0e; --card-bg: #16161a; --text-color: #e0e0e0;
            --accent-color: #ff0055; --accent-grad: linear-gradient(135deg, #ff0055, #ff5500);
            --input-bg: #222226; --border-radius: 20px;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; perspective: 2000px; overflow: hidden; touch-action: none; }
        
        .book { width: 95%; max-width: 450px; height: 90vh; position: relative; transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
        .book.flipped { transform: rotateY(-180deg); }

        .page { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--border-radius); background: var(--card-bg); border: 1px solid #333; display: flex; flex-direction: column; box-shadow: 0 15px 35px rgba(0,0,0,0.7); }
        .page.back { transform: rotateY(180deg); }

        .content { padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .swipe-hint { font-size: 10px; color: #555; text-align: center; text-transform: uppercase; letter-spacing: 2px; }

        .header { text-align: center; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .banner-img { width: 100%; height: 75px; border-radius: 10px; object-fit: cover; border: 1px solid var(--accent-color); }
        
        .action-btn { background: var(--accent-grad); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 13px; display: flex; align-items: center; justify-content: center; }
        .action-btn.secondary { background: #2a2a2e; border: 1px solid #444; }
        
        #chat-container { flex: 1; background: #000; border-radius: 12px; padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; border: 1px solid #222; }
        .message { padding: 10px; border-radius: 12px; font-size: 14px; max-width: 85%; line-height: 1.4; }
        .message.user { align-self: flex-end; background: var(--accent-color); }
        .message.ai { align-self: flex-start; background: #2a2a2e; border: 1px solid #3d3d42; }

        .input-group { display: flex; gap: 8px; align-items: stretch; }
        textarea, input, select { background: var(--input-bg); border: 1px solid #444; color: white; padding: 12px; border-radius: 12px; width: 100%; box-sizing: border-box; font-size: 14px; outline: none; }

        .voice-active { background: #ff0000 !important; animation: pulse 1.2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 85, 0.6); } 70% { box-shadow: 0 0 0 10px rgba(255, 0, 85, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 85, 0); } }

        #image-container { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .img-wrapper img { width: 100%; border-radius: 10px; border: 1px solid #444; }
    </style>
</head>
<body>

<div class="book" id="myBook">
    <div class="page front">
        <div class="content">
            <div class="swipe-hint">–°–≤–∞–π–ø –≤–ª–µ–≤–æ –¥–ª—è —á–∞—Ç–∞ ‚Æï</div>
            <div class="header">
                <img src="1768422265866.jpg" class="banner-img" onerror="this.src='https://via.placeholder.com/500x100?text=BOSS+ART'">
            </div>
            
            <div class="input-group">
                <select id="model-select">
                    <option value="flux">üöõ –ö–∞—á–µ—Å—Ç–≤–æ (Flux)</option>
                    <option value="flux-realism">üì∏ –§–æ—Ç–æ (Real)</option>
                </select>
                <button class="action-btn secondary" onclick="clearBoard()">üóëÔ∏è</button>
            </div>

            <textarea id="prompt-input" rows="3" placeholder="–°–∫–∞–∂–∏ —á—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å..."></textarea>
            
            <button id="v-art" class="action-btn" onclick="runVoice('art')">üé§ –°–∫–∞–∑–∞—Ç—å –∏ –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å (–ê–≤—Ç–æ)</button>
            <button class="action-btn secondary" onclick="generateImage()">üöÄ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫</button>
            
            <div id="image-container"></div>
        </div>
    </div>

    <div class="page back">
        <div class="content">
            <div class="swipe-hint">‚¨Ö –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –¥–ª—è –ê—Ä—Ç–∞</div>
            <div class="header">
                <div class="input-group">
                    <select id="chat-model-select" style="font-size: 12px;">
                        <option value="openai">ü§ñ ChatGPT (OpenAI)</option>
                        <option value="llama">ü¶ô Llama 3</option>
                        <option value="mistral">üåÄ Mistral</option>
                    </select>
                    <button class="action-btn secondary" onclick="clearChat()">üóëÔ∏è</button>
                </div>
            </div>

            <div id="chat-container"></div>

            <div class="input-group">
                <button id="v-chat" class="action-btn" onclick="runVoice('chat')">üé§</button>
                <input type="text" id="chat-input" placeholder="–°–ø—Ä–æ—Å–∏ —É BOSS AI..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="action-btn" onclick="sendMessage()">‚û§</button>
            </div>
            <button class="action-btn secondary" style="font-size: 10px; padding: 5px;" onclick="stopSpeech()">üîá –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å</button>
        </div>
    </div>
</div>

<script>
    const book = document.getElementById('myBook');
    let touchStartX = 0;
    let touchEndX = 0;

    // –°–í–ê–ô–ü–´
    document.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, false);
    document.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); }, false);
    function handleSwipe() {
        const threshold = 80;
        if (touchEndX < touchStartX - threshold && !book.classList.contains('flipped')) { book.classList.add('flipped'); stopSpeech(); }
        if (touchEndX > touchStartX + threshold && book.classList.contains('flipped')) { book.classList.remove('flipped'); stopSpeech(); }
    }

    // –ì–û–õ–û–°
    function speak(t) {
        stopSpeech();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'ru-RU';
        window.speechSynthesis.speak(u);
    }
    function stopSpeech() { window.speechSynthesis.cancel(); }

    function runVoice(mode) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) return alert("–ì–æ–ª–æ—Å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
        const rec = new SpeechRecognition();
        rec.lang = 'ru-RU';
        const btn = mode === 'art' ? document.getElementById('v-art') : document.getElementById('v-chat');
        rec.onstart = () => btn.classList.add('voice-active');
        rec.onend = () => btn.classList.remove('voice-active');
        rec.onresult = async (e) => {
            const txt = e.results[0][0].transcript;
            if (mode === 'art') {
                document.getElementById('prompt-input').value = "‚è≥ –†–∏—Å—É—é...";
                const translated = await translate(txt);
                document.getElementById('prompt-input').value = translated;
                generateImage();
            } else {
                document.getElementById('chat-input').value = txt;
                sendMessage();
            }
        };
        rec.start();
    }

    async function translate(t) {
        try {
            const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=ru&tl=en&dt=t&q=${encodeURIComponent(t)}`);
            const d = await r.json(); return d[0][0][0];
        } catch { return t; }
    }

    // –ß–ê–¢
    async function sendMessage() {
        const inp = document.getElementById('chat-input');
        const box = document.getElementById('chat-container');
        const model = document.getElementById('chat-model-select').value;
        if(!inp.value.trim()) return;
        const m = inp.value;
        box.innerHTML += `<div class="message user">${m}</div>`;
        inp.value = '';
        const loader = document.createElement('div');
        loader.className = 'message ai'; loader.innerText = '‚è≥ –î—É–º–∞—é...';
        box.appendChild(loader);
        box.scrollTop = box.scrollHeight;
        try {
            const r = await fetch(`https://text.pollinations.ai/${encodeURIComponent(m)}?model=${model}`);
            const t = await r.text();
            loader.innerHTML = marked.parse(t);
            speak(t.replace(/[#*`]/g, ''));
        } catch { loader.innerText = '‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (502).'; }
        box.scrollTop = box.scrollHeight;
    }

    // –ê–†–¢
    function generateImage() {
        const p = document.getElementById('prompt-input').value;
        const m = document.getElementById('model-select').value;
        if(!p || p.includes("‚è≥")) return;
        const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?model=${m}&seed=${Math.random()}&nologo=true`;
        const wrap = document.createElement('div');
        wrap.className = 'img-wrapper';
        wrap.innerHTML = `<img src="${url}" onclick="window.open('${url}')">`;
        document.getElementById('image-container').prepend(wrap);
    }

    function clearChat() { document.getElementById('chat-container').innerHTML = ''; stopSpeech(); }
    function clearBoard() { document.getElementById('image-container').innerHTML = ''; document.getElementById('prompt-input').value = ''; }
</script>

</body>
</html>
