<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ULTRA ‚Äî BOSS FINAL RECOVERY</title>
    
    <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --paper: #f4e4bc; --ink: #2c241a; --gold: #d4af37; --accent: #8b0000; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            font-family: "Georgia", serif; 
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∫–∏ */
        .viewport { 
            width: 100vw; height: 100vh; 
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        #book-container { background: transparent; }

        .page { background: var(--paper); width: 100%; height: 100%; }
        
        .paper-sheet { 
            background: var(--paper); 
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png'); 
            display: flex; flex-direction: column; 
            height: 100%; width: 100%; 
            box-sizing: border-box; 
            border: 1px solid rgba(0,0,0,0.1); 
        }

        /* –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê ‚Äî –ü–†–ò–û–†–ò–¢–ï–¢ ‚Ññ1 */
        .input-bar { 
            padding: 10px; background: #e8d5a7; 
            display: flex; gap: 8px; align-items: center; 
            border-top: 2px solid var(--ink);
            position: relative; z-index: 10000 !important;
            pointer-events: auto !important;
        }

        .field { 
            flex: 1; background: #fff; border: 1px solid #aaa; padding: 10px; 
            border-radius: 20px; outline: none; font-size: 16px; color: #000;
            pointer-events: auto !important;
        }

        .btn { 
            background: none; border: none; font-size: 20px; cursor: pointer; 
            color: var(--ink); pointer-events: auto !important;
        }

        .scroll-area { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; touch-action: pan-y; }
        
        .cover-front { background: #2b0000; border: 6px double var(--gold); display: flex; flex-direction: column; height: 100%; box-sizing: border-box;}
        .v-box { width: 100%; height: 55%; background: #000; border-bottom: 3px solid var(--gold); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .v-box video { width: 100%; height: 100%; object-fit: cover; }
        .c-text { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--gold); text-align: center; }

        .mic-active { color: var(--accent) !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="viewport">
    <div id="book-container">
        <div class="page" data-density="hard">
            <div class="cover-front">
                <div class="v-box"><video autoplay loop muted playsinline><source src="https://raw.githubusercontent.com/garik964186-blip/ai-truck-studio/main/1768452401066.mp4" type="video/mp4"></video></div>
                <div class="c-text">
                    <h2 style="margin:0;">ULTRA</h2>
                    <p style="font-size: 14px;">–ö–ù–ò–ì–ê –ë–û–°–°–ê</p>
                </div>
            </div>
        </div>
        
        <div class="page">
            <div class="paper-sheet">
                <div style="padding:8px; text-align:center; font-weight:bold; border-bottom:1px solid #222; font-size: 14px;">üîÆ –£–ú–ù–´–ô –ß–ê–¢</div>
                <div id="hub-box" class="scroll-area"></div>
                <div class="input-bar">
                    <button id="btn-mic" onclick="startMic('i-hub', 'btn-mic', sendMsg)" class="btn"><i class="fas fa-microphone"></i></button>
                    <input type="text" id="i-hub" class="field" placeholder="–°–ø—Ä–æ—Å–∏...">
                    <button onclick="sendMsg()" class="btn"><i class="fas fa-paper-plane" style="color:var(--accent)"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let pageFlip;
    const flipSound = new Audio('https://www.soundjay.com/misc/sounds/page-flip-01a.mp3');
    let isPaused = false;

    function initBook() {
        const w = window.innerWidth;
        const h = window.innerHeight;
        
        // –†–∞—Å—á–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
        const bookW = Math.min(w * 0.95, 450);
        const bookH = Math.min(h * 0.90, 800);

        pageFlip = new St.PageFlip(document.getElementById("book-container"), {
            width: bookW,
            height: bookH,
            size: "fixed", 
            minWidth: 300,
            maxWidth: 450,
            minHeight: 500,
            maxHeight: 850,
            showCover: true,
            usePortrait: true,
            clickEventForward: true
        });

        pageFlip.loadFromHTML(document.querySelectorAll(".page"));
        
        pageFlip.on('flip', () => { 
            flipSound.currentTime = 0; 
            flipSound.play(); 
        });
    }

    document.addEventListener('DOMContentLoaded', initBook);
    window.addEventListener('resize', () => { location.reload(); }); // –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ —ç–∫—Ä–∞–Ω–∞

    // –ì–ò–ë–†–ò–î–ù–´–ô –ü–ï–†–ï–í–û–î–ß–ò–ö –ò –ß–ê–¢
    async function sendMsg() {
        const i = document.getElementById('i-hub'), b = document.getElementById('hub-box');
        if(!i.value) return;
        const userText = i.value; i.value = '';
        
        b.innerHTML = `<div style="margin-bottom:10px;"><b>–í—ã:</b> ${userText}</div>` + b.innerHTML;

        try {
            // –ê–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è AI
            const prompt = `Answer in Russian. Question: ${userText}`;
            const res = await fetch(`https://text.pollinations.ai/prompt/${encodeURIComponent(prompt)}?model=openai`);
            const data = await res.text();
            
            b.innerHTML = `<div style="border-bottom:1px dashed #ccc; padding-bottom:10px; margin-bottom:15px;"><b>AI:</b> ${marked.parse(data)}</div>` + b.innerHTML;
            speak(data);
        } catch(e) { b.innerHTML = "<div>–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏...</div>" + b.innerHTML; }
    }

    function startMic(inputId, btnId, callback) {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Speech) return alert("–ì–æ–ª–æ—Å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
        const rec = new Speech();
        rec.lang = 'ru-RU';
        const btn = document.getElementById(btnId);
        rec.onstart = () => btn.classList.add('mic-active');
        rec.onresult = (e) => { document.getElementById(inputId).value = e.results[0][0].transcript; callback(); };
        rec.onend = () => btn.classList.remove('mic-active');
        rec.start();
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text.replace(/[#*`_]/g, ''));
        msg.lang = 'ru-RU';
        window.speechSynthesis.speak(msg);
    }
</script>
</body>
</html>
