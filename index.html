<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BOSS AI BOOK: FINAL FIX</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #0b0b0e; --card-bg: #16161a; --text-color: #e0e0e0;
            --accent-color: #ff0055; --accent-grad: linear-gradient(135deg, #ff0055, #ff5500);
            --input-bg: #222226; --border-radius: 20px;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; perspective: 2000px; overflow: hidden; touch-action: none; }
        
        .book { width: 95%; max-width: 450px; height: 90vh; position: relative; transition: transform 0.6s ease-in-out; transform-style: preserve-3d; }
        .book.flipped { transform: rotateY(-180deg); }

        .page { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--border-radius); background: var(--card-bg); border: 1px solid #333; display: flex; flex-direction: column; box-shadow: 0 15px 35px rgba(0,0,0,0.7); overflow: hidden; }
        .page.back { transform: rotateY(180deg); }

        .content { padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .header { text-align: center; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 5px; }
        .banner-img { width: 100%; height: 75px; border-radius: 10px; object-fit: cover; border: 1px solid var(--accent-color); }
        
        .action-btn { background: var(--accent-grad); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .action-btn:active { transform: scale(0.95); }
        .action-btn.secondary { background: #2a2a2e; border: 1px solid #444; }
        
        #chat-container { flex: 1; background: #000; border-radius: 12px; padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; border: 1px solid #222; }
        .message { padding: 10px; border-radius: 12px; font-size: 14px; max-width: 85%; word-wrap: break-word; }
        .message.user { align-self: flex-end; background: var(--accent-color); color: white; }
        .message.ai { align-self: flex-start; background: #2a2a2e; border: 1px solid #3d3d42; color: #fff; }

        .input-group { display: flex; gap: 8px; }
        textarea, input, select { background: var(--input-bg); border: 1px solid #444; color: white; padding: 12px; border-radius: 12px; width: 100%; box-sizing: border-box; font-size: 14px; outline: none; }

        .v-active { background: #ff0000 !important; box-shadow: 0 0 15px #ff0000; }
        #image-container { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .img-wrapper img { width: 100%; border-radius: 10px; border: 1px solid #444; }
        .swipe-info { font-size: 9px; opacity: 0.5; text-align: center; margin-bottom: 5px; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="book" id="myBook">
    <div class="page front">
        <div class="content">
            <div class="swipe-info">‚¨Ö –°–≤–∞–π–ø –≤–ª–µ–≤–æ –¥–ª—è —á–∞—Ç–∞</div>
            <div class="header">
                <img src="1768422265866.jpg" class="banner-img" onerror="this.src='https://via.placeholder.com/450x100?text=BOSS+ART'">
            </div>
            
            <select id="model-select">
                <option value="flux">üöõ –ö–∞—á–µ—Å—Ç–≤–æ (Flux)</option>
                <option value="flux-realism">üì∏ –§–æ—Ç–æ (Real)</option>
            </select>

            <textarea id="prompt-input" rows="3" placeholder="–ß—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å, –±–æ—Å—Å?"></textarea>
            
            <div class="input-group">
                <button id="v-art" class="action-btn" style="flex:1" onclick="runVoice('art')">üé§ –ì–û–õ–û–° + –ê–í–¢–û</button>
                <button class="action-btn secondary" onclick="clearBoard()">üóëÔ∏è</button>
            </div>
            
            <button class="action-btn" onclick="generateImage()" style="background:#333">üöÄ –†–£–ß–ù–û–ô –ó–ê–ü–£–°–ö</button>
            <div id="image-container"></div>
        </div>
    </div>

    <div class="page back">
        <div class="content">
            <div class="swipe-info">–°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –¥–ª—è –∞—Ä—Ç–æ–≤ ‚Æï</div>
            <div class="header">
                <div class="input-group">
                    <select id="chat-model-select">
                        <option value="openai">ü§ñ ChatGPT (OpenAI)</option>
                        <option value="mistral">üåÄ Mistral Model</option>
                        <option value="llama">ü¶ô Llama 3 (Meta)</option>
                    </select>
                </div>
            </div>

            <div id="chat-container"></div>

            <div class="input-group">
                <button id="v-chat" class="action-btn" onclick="runVoice('chat')">üé§</button>
                <input type="text" id="chat-input" placeholder="–°–ø—Ä–æ—Å–∏..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="action-btn" onclick="sendMessage()">‚û§</button>
            </div>
            <div class="input-group">
                <button class="action-btn secondary" style="flex:1; font-size:10px" onclick="stopSpeech()">üîá –°–¢–û–ü</button>
                <button class="action-btn secondary" style="flex:1; font-size:10px" onclick="clearChat()">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨</button>
            </div>
        </div>
    </div>
</div>

<script>
    const book = document.getElementById('myBook');
    let touchX = 0;

    // –°–í–ê–ô–ü–´
    document.addEventListener('touchstart', e => touchX = e.touches[0].clientX);
    document.addEventListener('touchend', e => {
        const diff = touchX - e.changedTouches[0].clientX;
        if (diff > 80 && !book.classList.contains('flipped')) { book.classList.add('flipped'); stopSpeech(); }
        else if (diff < -80 && book.classList.contains('flipped')) { book.classList.remove('flipped'); stopSpeech(); }
    });

    // –ì–û–õ–û–°
    function speak(t) {
        stopSpeech();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'ru-RU';
        window.speechSynthesis.speak(u);
    }
    function stopSpeech() { window.speechSynthesis.cancel(); }

    function runVoice(mode) {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ru-RU';
        const btn = document.getElementById(mode === 'art' ? 'v-art' : 'v-chat');
        
        recognition.onstart = () => btn.classList.add('v-active');
        recognition.onend = () => btn.classList.remove('v-active');
        recognition.onresult = async (event) => {
            const text = event.results[0][0].transcript;
            if (mode === 'art') {
                document.getElementById('prompt-input').value = "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...";
                const trans = await translate(text);
                document.getElementById('prompt-input').value = trans;
                generateImage();
            } else {
                document.getElementById('chat-input').value = text;
                sendMessage();
            }
        };
        recognition.start();
    }

    async function translate(t) {
        try {
            const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=ru&tl=en&dt=t&q=${encodeURIComponent(t)}`);
            const d = await r.json(); return d[0][0][0];
        } catch { return t; }
    }

    // –ß–ê–¢ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ó–ê–ü–†–û–°
    async function sendMessage() {
        const inp = document.getElementById('chat-input');
        const container = document.getElementById('chat-container');
        const model = document.getElementById('chat-model-select').value;
        const msg = inp.value.trim();
        
        if (!msg) return;
        
        container.innerHTML += `<div class="message user">${msg}</div>`;
        inp.value = '';
        
        const loader = document.createElement('div');
        loader.className = 'message ai';
        loader.innerText = '‚è≥ –î—É–º–∞—é...';
        container.appendChild(loader);
        container.scrollTop = container.scrollHeight;

        try {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π URL –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(msg)}?model=${model}&system=You+are+helpful+AI+partner`);
            
            if (!response.ok) throw new Error('502');
            
            const text = await response.text();
            loader.innerHTML = marked.parse(text);
            speak(text.replace(/[#*`]/g, ''));
        } catch (e) {
            loader.innerHTML = `<span style="color:#ff5500">‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä ${model} –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å –≤ –º–µ–Ω—é —Å–≤–µ—Ä—Ö—É.</span>`;
        }
        container.scrollTop = container.scrollHeight;
    }

    // –ê–†–¢
    function generateImage() {
        const prompt = document.getElementById('prompt-input').value;
        const model = document.getElementById('model-select').value;
        if (!prompt || prompt.includes('‚è≥')) return;

        const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?model=${model}&seed=${Math.floor(Math.random()*1e9)}&nologo=true`;
        
        const wrap = document.createElement('div');
        wrap.className = 'img-wrapper';
        wrap.innerHTML = `<img src="${url}" onclick="window.open('${url}')">`;
        document.getElementById('image-container').prepend(wrap);
    }

    function clearChat() { document.getElementById('chat-container').innerHTML = ''; stopSpeech(); }
    function clearBoard() { document.getElementById('image-container').innerHTML = ''; document.getElementById('prompt-input').value = ''; }
</script>

</body>
</html>
